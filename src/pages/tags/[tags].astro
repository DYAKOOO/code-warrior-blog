---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const notes = await getCollection('notes');
  const tags = [...new Set(notes.flatMap(note => note.data.tags))];
  
  return tags.map(tag => ({
    params: { tag },
    props: { notes: notes.filter(note => note.data.tags.includes(tag)) },
  }));
}

interface Props {
  notes: CollectionEntry<'notes'>[];
}

const { tag } = Astro.params;
const { notes } = Astro.props;
---

<Layout title={`Notes tagged with ${tag}`}>
  <h1>Notes tagged with "{tag}"</h1>
  <ul>
    {notes.map(note => (
      <li><a href={`/notes/${note.slug}`}>{note.data.title}</a></li>
    ))}
  </ul>
</Layout>